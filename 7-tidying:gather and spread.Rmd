---
title: "7-tidying/gather and spread"
output: html_notebook
---
Only need to do the first three
```{r}
library(tidyr)
library(tidyverse)
long_questions <- function(country, country_before, column){
			  #Starting at index 1
			  i <- 1
number_for_dupID <- rep(NA, column)
new_list <- rep(NA, column)
#Replaces original column names with readable version
			  while(i <= column){
			    #Isolates original column names
			    original <- (country$column_name)[i]
			    #Replaces with label
			    new <- attributes(country_before[[original]])$label
			    #Adds object to list
			    new_list[i] <- new
			    #Moves to next item
			    i <- i + 1
			  }
			  new_list
			}
lengthen <- function(country) {
			  country_before <- country
			  country <- country %>%
 #These are excluded because they are repeated
			  select(-strata,-sex, -vb11_10, -vb11_12) %>%
			  #Brings together the following columns
			  gather(column_name, answer, estratopri:vb_combined)
#Takes length of column_name and arguments from long_questions
			  column <- length(country$column_name)
			  questions <- long_questions(country, country_before, column)
 country <- country %>% 
			    mutate(questions)
country <- country %>% 
			    select(pais, year, unique_id, column_name, answer, questions, extra_id)
			  return(country)
			}

```

```{r}
tidy_spread <- function(x){
  x <- x %>%
    select(-column_name) %>%
    spread(questions, answer)
}
```

```{r}
argentina_wide <- tidy_spread(lengthen(argentina_na))
belize_wide <- tidy_spread(lengthen(belize_na))
brazil_wide <- tidy_spread(lengthen(brazil_na))
chile_wide <- tidy_spread(lengthen(chile_na))
panama_wide <- tidy_spread(lengthen(panama_na))
paraguay_wide <- tidy_spread(lengthen(paraguay_na))
peru_wide <- tidy_spread(lengthen(peru_na))
#suriname_wide <- tidy_spread(lengthen(suriname_na)) - says that no unique combination, but the combination seems unique...
uruguay_wide <- tidy_spread(lengthen(uruguay_na))
venezuela_wide <- tidy_spread(lengthen(venezuela_na))
bolivia_wide <- tidy_spread(lengthen(bolivia_na))
canada_wide <- tidy_spread(lengthen(canada_na))
colombia_wide <- tidy_spread(lengthen(colombia_na))
costa_wide <- tidy_spread(lengthen(costa_na))
ecuador_wide <- tidy_spread(lengthen(ecuador_na))
elsalvador_wide <- tidy_spread(lengthen(elsalvador_na))
guatemala_wide <- tidy_spread(lengthen(guatemala_na))
honduras_wide <- tidy_spread(lengthen(honduras_na))
mexico_wide <- tidy_spread(lengthen(mexico_na))
nicaragua_wide <- tidy_spread(lengthen(nicaragua_na))
usa_wide <- tidy_spread(lengthen(usa_na))
```

Created these next things in order to try to continue working with the common columns, but had to end up doing it a different way, can't shrink based off of common columns until later - were running into issues with unique keys and also the number of columns that each country had

```{r}
library(tidyr)
library(tidyverse)
long_questions <- function(country, country_before, column){
			  #Starting at index 1
			  i <- 1
number_for_dupID <- rep(NA, column)
new_list <- rep(NA, column)
#Replaces original column names with readable version
			  while(i <= column){
			    #Isolates original column names
			    original <- (country$column_name)[i]
			    #Replaces with label
			    new <- attributes(country_before[[original]])$label
			    #Adds object to list
			    new_list[i] <- new
			    #Moves to next item
			    i <- i + 1
			  }
			  new_list
			}
lengthen2 <- function(country) {
			  country_before <- country
			  country <- country %>%
 #These are excluded because they are repeated
			  select(-strata,-sex, -gi7r, -idnum_14) %>%
			  #Brings together the following columns
			  gather(column_name, answer, estratopri:vic2)
#Takes length of column_name and arguments from long_questions
			  column <- length(country$column_name)
			  questions <- long_questions(country, country_before, column)
 country <- country %>% 
			    mutate(questions)
country <- country %>% 
			    select(pais, year, unique_id, column_name, answer, questions, extra_id)
			  return(country)
			}

```

when running this it dramatically shrinks the number of columns.......and not in a consistent manner





```{r}

arg <- tidy_spread(lengthen2(argentina_nax))
argentina_widex <- tidy_spread(lengthen2(argentina_nax))
bel_long <- lengthen2(belize_nax)
belize_widex <- tidy_spread(lengthen2(belize_nax))
brazx_long <- lengthen2(brazil_nax)
brazil_widex <- tidy_spread(lengthen2(brazil_nax))
chile_widex <- tidy_spread(lengthen2(chile_nax))
panama_widex <- tidy_spread(lengthen2(panama_nax))
paraguay_widex <- tidy_spread(lengthen2(paraguay_nax))
peru_widex <- tidy_spread(lengthen2(peru_nax))
#suriname_widex <- tidy_spread(lengthen2(suriname_nax)) - says that no unique combination, but the combination seems unique...
uruguay_widex <- tidy_spread(lengthen2(uruguay_nax))
venezuela_widex <- tidy_spread(lengthen2(venezuela_nax))
bolivia_widex <- tidy_spread(lengthen2(bolivia_nax))
canada_widex <- tidy_spread(lengthen2(canada_nax))
colombia_widex <- tidy_spread(lengthen2(colombiax))
costa_widex <- tidy_spread(lengthen2(costa_nax))
ecuador_widex <- tidy_spread(lengthen2(ecuador_nax))
elsalvador_widex <- tidy_spread(lengthen2(elsalvador_nax))
guatemala_widex <- tidy_spread(lengthen2(guatemala_nax))
honduras_widex <- tidy_spread(lengthen2(honduras_nax))
mexico_widex <- tidy_spread(lengthen2(mexico_nax))
nicaragua_widex <- tidy_spread(lengthen2(nicaragua_nax))
usa_widex <- tidy_spread(lengthen2(usa_nax))
```

belize: * 226617, 617081 

```{r}
argentina_widex <- tidy_spread(lengthen2(argentina_nax))
belize_widex <- tidy_spread(lengthen2(belize_nax))
brazx_long <- lengthen2(brazil_nax)
brazil_widex <- tidy_spread(lengthen2(brazil_nax))
chile_widex <- tidy_spread(lengthen2(chile_nax))
panama_widex <- tidy_spread(lengthen2(panama_nax))
```


