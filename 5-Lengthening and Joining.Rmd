---
title: "5-Lengthening and Joining"
output: html_notebook
editor_options: 
  chunk_output_type: inline
---

# Structure
In this document, we lengthened all of the data frames we created before, combined the 2016/17 datasets with their respecitve factored and unfactored versions, and merged the unfactored and factored versions together.

Lengthening the data frames allows for us to put the data in a tidy format. Tidy data is a way of organizing data that makes it easy to visualize. This was developed by Hadley Wickham, and you can read more about tidy data [here](https://vita.had.co.nz/papers/tidy-data.pdf). When we simply read in the datasets, there are hundreds of columns, but by lengthening the data frame, we narrow the column down to five and it is easier to manage.

## Functions to lengthen unfactored versions
The first thing that we do is create a long, tidy version of the data. This makes it easier to filter and select what we want later on. We gathered the data so that "column_name" would have all the column names and "answer" would have all the observations to the corresponding column name.

Then, we transformed answer to a character which is necessary for the later combination with the 2016/17 data frame. If you are not merging, you *do not* need to transform the answer column.

Finally, we select the five columns that we want.

We realize that it would have been easier to have written a single function for this process, so if you wanna make one, go for it! :)

### For merged unfactored datasets
```{r}
lengthen <- function(country) {
  #makes sure the weight is saved
  weight <- country %>%
    select(wt)
  weight <- weight %>% rename(weights = wt)
    #Brings together the following columns
  country <- bind_cols(country,weight)
  country <- country %>%
    gather(column_name, answer_measure, estratopri:formatq)
  #Necessary when joining with 16/17
  country <- transform(country, answer_measure = as.character(answer_measure))
  #Selects the columns we want
  country <- country %>% 
    select(pais, wave, uniq_id, column_name, answer_measure, weights)
  return(country)
}
```



### For 16/17 unfactored datasets.
```{r}
lengthen_16 <- function(country) {
  #makes sure the weight is saved
  weight <- country %>%
    select(wt)
  weight <- weight %>% rename(weights = wt)
    #Brings together the following columns
  country <- bind_cols(country,weight)
  country <- country %>%
    #Brings together the following columns
    gather(column_name, answer_measure, estratopri:formatq)
  
  #Necessary when joining with merged files
  country <- transform(country, answer_measure = as.character(answer_measure))
  
  #Selects the columns we want
  country <- country %>% 
    select(pais, wave, uniq_id, column_name, answer_measure, weights)
  return(country)
}
```

## Applying `lengthen()` and adding category and question columns
We applied the same functions to each of the datasets in the same order to end up with a fully merged, unfactored, tidy dataset.
```{r}
#Argentina
#Lengthen both datasets
argentina_long_unfactor <- lengthen(argentina_unique_unfactor)
argentina16_long_unfactor <- lengthen_16(argentina_16_unfactor)
#Combine merged and 2016/17 (not necessary if only using merged files)
argentina_joined <- union_all(argentina_long_unfactor, argentina16_long_unfactor) %>% 
  #Transforms answer back to numeric
  transform(answer_measure = as.numeric(answer_measure))
#Joins the excel datsets
argentina_joined <- argentina_joined %>%
  left_join(unfactored_questions, by = 'column_name')
argentina_joined <- argentina_joined %>%
  left_join(unfactored_categories, by = 'column_name')
#Get rid of all the categories that are NA
argentina_joined <- argentina_joined %>%
  filter(is.na(category) == FALSE)

#Belize
belize_long_unfactor <- lengthen(belize_unique_unfactor)
#No 16/17 for Belize
belize_category_unfactor <- belize_long_unfactor %>%
  left_join(unfactored_questions, by = 'column_name')
belize_category_unfactor <- belize_category_unfactor %>%
  left_join(unfactored_categories, by = 'column_name')
belize_category_unfactor <- belize_category_unfactor %>% filter(is.na(category) == FALSE)

#Brazil
brazil_long_unfactor <- lengthen(brazil_unique_unfactor)
brazil16_long_unfactor <- lengthen(brazil_16_unfactor)
brazil_joined <- union_all(brazil_long_unfactor, brazil16_long_unfactor) %>% 
  transform(answer_measure = as.numeric(answer_measure))
brazil_joined <- brazil_joined %>%
  left_join(unfactored_questions, by = 'column_name')
brazil_joined <- brazil_joined %>%
  left_join(unfactored_categories, by = 'column_name')
brazil_joined <- brazil_joined %>%
  filter(is.na(category) == FALSE)

#Chile
chile_long_unfactor <- lengthen(chile_unique_unfactor)
chile16_long_unfactor <- lengthen(chile_16_unfactor)
chile_joined <- union_all(chile_long_unfactor, chile16_long_unfactor) %>% 
  transform(answer_measure = as.numeric(answer_measure))
chile_joined <- chile_joined %>%
  left_join(unfactored_questions, by = 'column_name')
chile_joined <- chile_joined %>%
  left_join(unfactored_categories, by = 'column_name')
chile_joined <- chile_joined %>%
  filter(is.na(category) == FALSE)

#Panama
panama_long_unfactor <- lengthen(panama_unique_unfactor)
panama16_long_unfactor <- lengthen(panama_16_unfactor)
panama_joined <- union_all(panama_long_unfactor, panama16_long_unfactor) %>% 
  transform(answer_measure = as.numeric(answer_measure))
panama_joined <- panama_joined %>%
  left_join(unfactored_questions, by = 'column_name')
panama_joined <- panama_joined %>%
  left_join(unfactored_categories, by = 'column_name')
panama_joined <- panama_joined %>%
  filter(is.na(category) == FALSE)


#Paraguay
paraguay_long_unfactor <- lengthen(paraguay_unique_unfactor)
paraguay16_long_unfactor <- lengthen(paraguay_16_unfactor)
paraguay_joined <- union_all(paraguay_long_unfactor, paraguay16_long_unfactor) %>% 
  transform(answer_measure = as.numeric(answer_measure))
paraguay_joined <- paraguay_joined %>%
  left_join(unfactored_questions, by = 'column_name')
paraguay_joined <-  paraguay_joined %>%
  left_join(unfactored_categories, by = 'column_name')
paraguay_joined  <- paraguay_joined  %>%
  filter(is.na(category) == FALSE)

#Peru
peru_long_unfactor <- lengthen(peru_unique_unfactor)
peru16_long_unfactor <- lengthen(peru_16_unfactor)
peru_joined <- union_all(peru_long_unfactor, peru16_long_unfactor) %>% 
  transform(answer_measure = as.numeric(answer_measure))
peru_joined <- peru_joined %>%
  left_join(unfactored_questions, by = 'column_name')
peru_joined <- peru_joined %>%
  left_join(unfactored_categories, by = 'column_name')
peru_joined  <- peru_joined  %>%
  filter(is.na(category) == FALSE)

#Suriname
#suriname_long_unfactor <- lengthen(suriname_unique_unfactor)
#suriname16_long_unfactor <- lengthen(suriname_16_unfactor)
#suriname_joined <- union_all(suriname_long_unfactor, suriname16_long_unfactor) %>% 
#  transform(answer_measure = as.numeric(answer_measure))
#suriname_joined <- suriname_joined %>%
  #left_join(unfactored_questions, by = 'column_name')
#suriname_joined <- suriname_joined %>% left_join(unfactored_categories, by = 'column_name')
#suriname_joined  <- suriname_joined %>% filter(is.na(category) == FALSE)


#Uruguay
uruguay_long_unfactor <- lengthen(uruguay_unique_unfactor)
uruguay16_long_unfactor <- lengthen(uruguay_16_unfactor)
uruguay_joined <- union_all(uruguay_long_unfactor, uruguay16_long_unfactor) %>% 
  transform(answer_measure = as.numeric(answer_measure))
uruguay_joined <- uruguay_joined %>%
  left_join(unfactored_questions, by = 'column_name')
uruguay_joined <- uruguay_joined %>%
  left_join(unfactored_categories, by = 'column_name')
uruguay_joined  <- uruguay_joined %>%
  filter(is.na(category) == FALSE)

#Venezuela
venezuela_long_unfactor <- lengthen(venezuela_unique_unfactor)
venezuela16_long_unfactor <- lengthen(venezuela_16_unfactor)
venezuela_joined <- union_all(venezuela_long_unfactor, venezuela16_long_unfactor) %>% 
  transform(answer_measure = as.numeric(answer_measure))
venezuela_joined <- venezuela_joined %>%
  left_join(unfactored_questions, by = 'column_name')
venezuela_joined <- venezuela_joined %>%
  left_join(unfactored_categories, by = 'column_name')
venezuela_joined  <- venezuela_joined %>%
  filter(is.na(category) == FALSE)

#Bolivia
bolivia_long_unfactor <- lengthen(bolivia_unique_unfactor)
bolivia16_long_unfactor <- lengthen(bolivia_16_unfactor)
bolivia_joined <- union_all(bolivia_long_unfactor, bolivia16_long_unfactor) %>% 
  transform(answer_measure = as.numeric(answer_measure))
bolivia_joined <- bolivia_joined %>%
  left_join(unfactored_questions, by = 'column_name')
bolivia_joined <- bolivia_joined %>%
  left_join(unfactored_categories, by = 'column_name')
bolivia_joined  <- bolivia_joined %>%
  filter(is.na(category) == FALSE)


#Canada
canada_long_unfactor <- lengthen(canada_unique_unfactor)
canada16_long_unfactor <- lengthen(canada_16_unfactor)
canada_joined <- union_all(canada_long_unfactor, canada16_long_unfactor) %>% 
  transform(answer_measure = as.numeric(answer_measure))
canada_joined <- canada_joined %>%
  left_join(unfactored_questions, by = 'column_name')
canada_joined <- canada_joined %>%
  left_join(unfactored_categories, by = 'column_name')
canada_joined  <- canada_joined %>%
  filter(is.na(category) == FALSE)


#Colombia
colombia_long_unfactor <- lengthen(colombia_unique_unfactor)
colombia16_long_unfactor <- lengthen(colombia_16_unfactor)
colombia_joined <- union_all(colombia_long_unfactor, colombia16_long_unfactor) %>% 
  transform(answer_measure = as.numeric(answer_measure))
colombia_joined <- colombia_joined %>%
  left_join(unfactored_questions, by = 'column_name')
colombia_joined <- colombia_joined %>%
  left_join(unfactored_categories, by = 'column_name')
colombia_joined  <- colombia_joined %>%
  filter(is.na(category) == FALSE)


#Costa Rica
costa_long_unfactor <- lengthen(costa_unique_unfactor)
costa16_long_unfactor <- lengthen(costa_16_unfactor)
costa_joined <- union_all(costa_long_unfactor, costa16_long_unfactor) %>% 
  transform(answer_measure = as.numeric(answer_measure))
costa_joined <- costa_joined %>%
  left_join(unfactored_questions, by = 'column_name')
costa_joined <- costa_joined %>%
  left_join(unfactored_categories, by = 'column_name')
costa_joined  <- costa_joined %>%
  filter(is.na(category) == FALSE)


#Ecuador
ecuador_long_unfactor <- lengthen(ecuador_unique_unfactor)
ecuador16_long_unfactor <- lengthen(ecuador_16_unfactor)
ecuador_joined <- union_all(ecuador_long_unfactor, ecuador16_long_unfactor) %>% 
  transform(answer_measure = as.numeric(answer_measure))
ecuador_joined <- ecuador_joined %>%
  left_join(unfactored_questions, by = 'column_name')
ecuador_joined <- ecuador_joined %>%
  left_join(unfactored_categories, by = 'column_name')
ecuador_joined <- ecuador_joined %>%
  filter(is.na(category) == FALSE)


#El Salvador
elsalvador_long_unfactor <- lengthen(elsalvador_unique_unfactor)
elsalvador16_long_unfactor <- lengthen(elsalvador_16_unfactor)
elsalvador_joined <- union_all(elsalvador_long_unfactor, elsalvador16_long_unfactor) %>% 
  transform(answer_measure = as.numeric(answer_measure))
elsalvador_joined <- elsalvador_joined %>%
  left_join(unfactored_questions, by = 'column_name')
elsalvador_joined <- elsalvador_joined %>%
  left_join(unfactored_categories, by = 'column_name')
elsalvador_joined <- elsalvador_joined %>%
  filter(is.na(category) == FALSE)


#Guatemala
guatemala_long_unfactor <- lengthen(guatemala_unique_unfactor)
guatemala16_long_unfactor <- lengthen(guatemala_16_unfactor)
guatemala_joined <- union_all(guatemala_long_unfactor, guatemala16_long_unfactor) %>% 
  transform(answer_measure = as.numeric(answer_measure))
guatemala_joined <- guatemala_joined %>%
  left_join(unfactored_questions, by = 'column_name')
guatemala_joined <- guatemala_joined %>%
  left_join(unfactored_categories, by = 'column_name')
guatemala_joined <- guatemala_joined %>%
  filter(is.na(category) == FALSE)


#Honduras
honduras_long_unfactor <- lengthen(honduras_unique_unfactor)
honduras16_long_unfactor <- lengthen(honduras_16_unfactor)
honduras_joined <- union_all(honduras_long_unfactor, honduras16_long_unfactor) %>% 
  transform(answer_measure = as.numeric(answer_measure))
honduras_joined <- honduras_joined %>%
  left_join(unfactored_questions, by = 'column_name')
honduras_joined <- honduras_joined %>%
  left_join(unfactored_categories, by = 'column_name')
honduras_joined <- honduras_joined %>%
  filter(is.na(category) == FALSE)


#Mexico
mexico_long_unfactor <- lengthen(mexico_unique_unfactor)
mexico16_long_unfactor <- lengthen(mexico_16_unfactor)
mexico_joined <- union_all(mexico_long_unfactor, mexico16_long_unfactor) %>% 
  transform(answer_measure = as.numeric(answer_measure))
mexico_joined <- mexico_joined %>%
  left_join(unfactored_questions, by = 'column_name')
mexico_joined <- mexico_joined %>%
  left_join(unfactored_categories, by = 'column_name')
mexico_joined <- mexico_joined %>%
  filter(is.na(category) == FALSE)


#Nicaragua
nicaragua_long_unfactor <- lengthen(nicaragua_unique_unfactor)
nicaragua16_long_unfactor <- lengthen(nicaragua_16_unfactor)
nicaragua_joined <- union_all(nicaragua_long_unfactor, nicaragua16_long_unfactor) %>% 
  transform(answer_measure = as.numeric(answer_measure))
nicaragua_joined <- nicaragua_joined %>%
  left_join(unfactored_questions, by = 'column_name')
nicaragua_joined <- nicaragua_joined %>%
  left_join(unfactored_categories, by = 'column_name')
nicaragua_joined <- nicaragua_joined %>%
  filter(is.na(category) == FALSE)


#United States
usa_long_unfactor <- lengthen(usa_unique_unfactor)
usa16_long_unfactor <- lengthen(usa_16_unfactor)
usa_joined <- union_all(usa_long_unfactor, usa16_long_unfactor) %>% 
  transform(answer_measure = as.numeric(answer_measure))
usa_joined <- usa_joined %>%
  left_join(unfactored_questions, by = 'column_name')
usa_joined <- usa_joined %>%
  left_join(unfactored_categories, by = 'column_name')
usa_joined <- usa_joined %>%
  filter(is.na(category) == FALSE)

#Guyana
guyana_long_unfactor <- lengthen(guyana_unique_unfactor)
guyana16_long_unfactor <- lengthen(guyana_16_unfactor)
guyana_joined <- union_all(guyana_long_unfactor, guyana16_long_unfactor) %>% 
  transform(answer_measure = as.numeric(answer_measure))
guyana_joined <- guyana_joined %>%
  left_join(unfactored_questions, by = 'column_name')
guyana_joined <- guyana_joined %>%
  left_join(unfactored_categories, by = 'column_name')
guyana_joined <- guyana_joined %>%
  filter(is.na(category) == FALSE)

#Jamaica
jamaica_long_unfactor <- lengthen(jamaica_unique_unfactor)
jamaica16_long_unfactor <- lengthen(jamaica_16_unfactor)
jamaica_joined <- union_all(jamaica_long_unfactor, jamaica16_long_unfactor) %>% 
  transform(answer_measure = as.numeric(answer_measure))
jamaica_joined <- jamaica_joined %>%
  left_join(unfactored_questions, by = 'column_name')
jamaica_joined <- jamaica_joined %>%
  left_join(unfactored_categories, by = 'column_name')
jamaica_joined <- jamaica_joined %>%
  filter(is.na(category) == FALSE)

```



## Functions to lengthen factored versions
These functions are almost identical to the ones above except, they have "_factor" for the column names.
### For merged, factored datasets
```{r}
lengthen_factor <- function(country) {
  #makes sure the weight is saved
  weight <- country %>%
    select(wt)
  weight <- weight %>% rename(weights_factor = wt)
    #Brings together the following columns
  country <- bind_cols(country,weight)
  country <- country %>%
    #Brings together the following columns
    gather(column_name_factor, answer_dimension, estratopri_factor:formatq_factor)
  
  #Selects columns that we want
  country <- country %>% 
    select(pais_factor, wave_factor, uniq_id_factor, column_name_factor, answer_dimension, weights_factor)
  return(country)
}
```

### For 2016/17 factored datasets
```{r}
lengthen_16factor <- function(country) {
  #makes sure the weight is saved
  weight <- country %>%
    select(wt)
  weight <- weight %>% rename(weights_factor = wt)
    #Brings together the following columns
  country <- bind_cols(country,weight)
  country <- country %>%
    #Brings together the following columns
    gather(column_name_factor, answer_dimension, estratopri_factor:formatq_factor)
  
  #Selects columns that we want
  country <- country %>% 
    select(pais_factor, wave_factor, uniq_id_factor, column_name_factor, answer_dimension, weights_factor)
  return(country)
}
```


## Applying `lengthen()` and adding category and question columns
```{r}
#Belize
belize_long_factor <- lengthen_factor(belize_unique_factor)
#No 2016/17
belize_category_factor <- belize_long_factor %>%
  left_join(factored_questions, by = 'column_name_factor')
belize_category_factor <- belize_category_factor %>%
  left_join(factored_categories, by = 'column_name_factor')
belize_category_factor <- belize_category_factor %>%
  filter(is.na(category) == FALSE)


#Argentina
argentina_long_factor <- lengthen_factor(argentina_unique_factor)
argentina16_long_factor <- lengthen_16factor(argentina_16_factor)
argentina_joined_factor <- union_all(argentina_long_factor, argentina16_long_factor)
argentina_joined_factor <- argentina_joined_factor %>%
  left_join(factored_questions, by = 'column_name_factor')
argentina_joined_factor <- argentina_joined_factor %>%
  left_join(factored_categories, by = 'column_name_factor')
argentina_joined_factor <- argentina_joined_factor %>%
  filter(is.na(category) == FALSE)


#Brazil
brazil_long_factor <- lengthen_factor(brazil_unique_factor)
brazil16_long_factor <- lengthen_16factor(brazil_16_factor)
brazil_joined_factor <- union_all(brazil_long_factor, brazil16_long_factor) 
brazil_joined_factor <- brazil_joined_factor %>%
  left_join(factored_questions, by = 'column_name_factor')
brazil_joined_factor <- brazil_joined_factor %>%
  left_join(factored_categories, by = 'column_name_factor')
brazil_joined_factor <- brazil_joined_factor %>%
  filter(is.na(category) == FALSE)



#Chile
chile_long_factor <- lengthen_factor(chile_unique_factor)
chile16_long_factor <- lengthen_16factor(chile_16_factor)
chile_joined_factor <- union_all(chile_long_factor, chile16_long_factor)
chile_joined_factor <- chile_joined_factor %>%
  left_join(factored_questions, by = 'column_name_factor')
chile_joined_factor <- chile_joined_factor %>%
  left_join(factored_categories, by = 'column_name_factor')
chile_joined_factor <- chile_joined_factor %>%
  filter(is.na(category) == FALSE)


#Panama
panama_long_factor <- lengthen_factor(panama_unique_factor)
panama16_long_factor <- lengthen_16factor(panama_16_factor)
panama_joined_factor <- union_all(panama_long_factor, panama16_long_factor)
panama_joined_factor <- panama_joined_factor %>%
  left_join(factored_questions, by = 'column_name_factor')
panama_joined_factor <- panama_joined_factor %>%
  left_join(factored_categories, by = 'column_name_factor')
panama_joined_factor <- panama_joined_factor %>%
  filter(is.na(category) == FALSE)


#Paraguay
paraguay_long_factor <- lengthen_factor(paraguay_unique_factor)
paraguay16_long_factor <- lengthen_16factor(paraguay_16_factor)
paraguay_joined_factor <- union_all(paraguay_long_factor, paraguay16_long_factor) 
paraguay_joined_factor <- paraguay_joined_factor %>%
  left_join(factored_questions, by = 'column_name_factor')
paraguay_joined_factor<-  paraguay_joined_factor %>%
  left_join(factored_categories, by = 'column_name_factor')
paraguay_joined_factor <- paraguay_joined_factor %>%
  filter(is.na(category) == FALSE)


#Peru
peru_long_factor <- lengthen_factor(peru_unique_factor)
peru16_long_factor <- lengthen_16factor(peru_16_factor)
peru_joined_factor <- union_all(peru_long_factor, peru16_long_factor) 
peru_joined_factor <- peru_joined_factor %>%
  left_join(factored_questions, by = 'column_name_factor')
peru_joined_factor <- peru_joined_factor %>%
  left_join(factored_categories, by = 'column_name_factor')
peru_joined_factor <- peru_joined_factor %>%
  filter(is.na(category) == FALSE)

#Suriname
#suriname_long_factor <- lengthen_factor(suriname__unique_factor) 
#suriname16_long_factor <- lengthen_16factor(suriname_16_factor)
#suriname_joined_factor <- union_all(suriname_long_factor, suriname16_long_factor) 
#suriname_joined_factor <- suriname_joined_factor %>% left_join(unfactored_questions, by = 'column_name_factor')
#suriname_joined_factor <- suriname_joined_factor %>% left_join(factored_categories, by = 'column_name_factor')
#suriname_joined_factor <- suriname_joined_factor %>% filter(is.na(category) == FALSE)


#Uruguay
uruguay_long_factor <- lengthen_factor(uruguay_unique_factor)
uruguay16_long_factor <- lengthen_16factor(uruguay_16_factor)
uruguay_joined_factor <- union_all(uruguay_long_factor, uruguay16_long_factor)
uruguay_joined_factor <- uruguay_joined_factor %>%
  left_join(factored_questions, by = 'column_name_factor')
uruguay_joined_factor <- uruguay_joined_factor %>%
  left_join(factored_categories, by = 'column_name_factor')
uruguay_joined_factor <- uruguay_joined_factor %>%
  filter(is.na(category) == FALSE)


#Venezuela
venezuela_long_factor <- lengthen_factor(venezuela_unique_factor)
venezuela16_long_factor <- lengthen_16factor(venezuela_16_factor)
venezuela_joined_factor <- union_all(venezuela_long_factor, venezuela16_long_factor) 
venezuela_joined_factor <- venezuela_joined_factor %>%
  left_join(factored_questions, by = 'column_name_factor')
venezuela_joined_factor <- venezuela_joined_factor %>%
  left_join(factored_categories, by = 'column_name_factor')
venezuela_joined_factor <- venezuela_joined_factor %>%
  filter(is.na(category) == FALSE)


#Bolivia
bolivia_long_factor <- lengthen_factor(bolivia_unique_factor)
bolivia16_long_factor <- lengthen_16factor(bolivia_16_factor)
bolivia_joined_factor <- union_all(bolivia_long_factor, bolivia16_long_factor)
bolivia_joined_factor <- bolivia_joined_factor %>%
  left_join(factored_questions, by = 'column_name_factor')
bolivia_joined_factor <- bolivia_joined_factor %>% 
  left_join(factored_categories, by = 'column_name_factor')
bolivia_joined_factor <- bolivia_joined_factor %>%
  filter(is.na(category) == FALSE)


#Canada
canada_long_factor <- lengthen_factor(canada_unique_factor)
canada16_long_factor <- lengthen_16factor(canada_16_factor)
canada_joined_factor <- union_all(canada_long_factor, canada16_long_factor)
canada_joined_factor <- canada_joined_factor %>%
  left_join(factored_questions, by = 'column_name_factor')
canada_joined_factor <- canada_joined_factor %>%
  left_join(factored_categories, by = 'column_name_factor')
canada_joined_factor <- canada_joined_factor %>%
  filter(is.na(category) == FALSE)


#Colombia
colombia_long_factor <- lengthen_factor(colombia_unique_factor)
colombia16_long_factor <- lengthen_16factor(colombia_16_factor)
colombia_joined_factor <- union_all(colombia_long_factor, colombia16_long_factor) 
colombia_joined_factor <- colombia_joined_factor %>%
  left_join(factored_questions, by = 'column_name_factor')
colombia_joined_factor <- colombia_joined_factor %>%
  left_join(factored_categories, by = 'column_name_factor')
colombia_joined_factor <- colombia_joined_factor %>%
  filter(is.na(category) == FALSE)


#Costa Rica
costa_long_factor <- lengthen_factor(costa_unique_factor)
costa16_long_factor <- lengthen_16factor(costa_16_factor)
costa_joined_factor <- union_all(costa_long_factor, costa16_long_factor) 
costa_joined_factor <- costa_joined_factor %>%
  left_join(factored_questions, by = 'column_name_factor')
costa_joined_factor <- costa_joined_factor %>%
  left_join(factored_categories, by = 'column_name_factor')
costa_joined_factor <- costa_joined_factor %>%
  filter(is.na(category) == FALSE)


#Ecuador
ecuador_long_factor <- lengthen_factor(ecuador_unique_factor)
ecuador16_long_factor <- lengthen_16factor(ecuador_16_factor)
ecuador_joined_factor <- union_all(ecuador_long_factor, ecuador16_long_factor) 
ecuador_joined_factor <- ecuador_joined_factor %>%
  left_join(factored_questions, by = 'column_name_factor')
ecuador_joined_factor <- ecuador_joined_factor %>%
  left_join(factored_categories, by = 'column_name_factor')
ecuador_joined_factor <- ecuador_joined_factor %>%
  filter(is.na(category) == FALSE)


#El Salvador
elsalvador_long_factor <- lengthen_factor(elsalvador_unique_factor)
elsalvador16_long_factor <- lengthen_16factor(elsalvador_16_factor)
elsalvador_joined_factor <- union_all(elsalvador_long_factor, elsalvador16_long_factor) 
elsalvador_joined_factor <- elsalvador_joined_factor %>%
  left_join(factored_questions, by = 'column_name_factor')
elsalvador_joined_factor <- elsalvador_joined_factor %>%
  left_join(factored_categories, by = 'column_name_factor')
elsalvador_joined_factor <- elsalvador_joined_factor %>%
  filter(is.na(category) == FALSE)


#Guatemala
guatemala_long_factor <- lengthen_factor(guatemala_unique_factor)
guatemala16_long_factor <- lengthen_16factor(guatemala_16_factor)
guatemala_joined_factor <- union_all(guatemala_long_factor, guatemala16_long_factor) 
guatemala_joined_factor <- guatemala_joined_factor %>%
  left_join(factored_questions, by = 'column_name_factor')
guatemala_joined_factor<- guatemala_joined_factor %>% 
  left_join(factored_categories, by = 'column_name_factor')
guatemala_joined_factor <- guatemala_joined_factor %>%
  filter(is.na(category) == FALSE)


#Honduras
honduras_long_factor <- lengthen_factor(honduras_unique_factor)
honduras16_long_factor <- lengthen_16factor(honduras_16_factor)
honduras_joined_factor <- union_all(honduras_long_factor, honduras16_long_factor) 
honduras_joined_factor <- honduras_joined_factor %>%
  left_join(factored_questions, by = 'column_name_factor')
honduras_joined_factor <- honduras_joined_factor %>% 
  left_join(factored_categories, by = 'column_name_factor')
honduras_joined_factor <- honduras_joined_factor %>%
  filter(is.na(category) == FALSE)


#Mexico
mexico_long_factor <- lengthen_factor(mexico_unique_factor)
mexico16_long_factor <- lengthen_16factor(mexico_16_factor)
mexico_joined_factor <- union_all(mexico_long_factor, mexico16_long_factor)
mexico_joined_factor <- mexico_joined_factor %>%
  left_join(factored_questions, by = 'column_name_factor')
mexico_joined_factor <- mexico_joined_factor %>% 
  left_join(factored_categories, by = 'column_name_factor')
mexico_joined_factor <- mexico_joined_factor %>%
  filter(is.na(category) == FALSE)


#Nicaragua
nicaragua_long_factor <- lengthen_factor(nicaragua_unique_factor)
nicaragua16_long_factor <- lengthen_16factor(nicaragua_16_factor)
nicaragua_joined_factor <- union_all(nicaragua_long_factor, nicaragua16_long_factor) 
nicaragua_joined_factor <- nicaragua_joined_factor %>%
  left_join(factored_questions, by = 'column_name_factor')
nicaragua_joined_factor <- nicaragua_joined_factor %>% 
  left_join(factored_categories, by = 'column_name_factor')
nicaragua_joined_factor <- nicaragua_joined_factor %>%
  filter(is.na(category) == FALSE)


#United States
usa_long_factor <- lengthen_factor(usa_unique_factor)
usa16_long_factor <- lengthen_16factor(usa_16_factor)
usa_joined_factor <- union_all(usa_long_factor, usa16_long_factor) 
usa_joined_factor <- usa_joined_factor %>%
  left_join(factored_questions, by = 'column_name_factor')
usa_joined_factor <- usa_joined_factor %>% 
  left_join(factored_categories, by = 'column_name_factor')
usa_joined_factor <- usa_joined_factor %>%
  filter(is.na(category) == FALSE)

#Guyana
guyana_long_factor <- lengthen_factor(guyana_unique_factor)
guyana16_long_factor <- lengthen_16factor(guyana_16_factor)
guyana_joined_factor <- union_all(guyana_long_factor, guyana16_long_factor) 
guyana_joined_factor <- guyana_joined_factor %>%
  left_join(factored_questions, by = 'column_name_factor')
guyana_joined_factor <- guyana_joined_factor %>% 
  left_join(factored_categories, by = 'column_name_factor')
guyana_joined_factor <- guyana_joined_factor %>%
  filter(is.na(category) == FALSE)

#Jamaica
jamaica_long_factor <- lengthen_factor(jamaica_unique_factor)
jamaica16_long_factor <- lengthen_16factor(jamaica_16_factor)
jamaica_joined_factor <- union_all(jamaica_long_factor, jamaica16_long_factor) 
jamaica_joined_factor <- jamaica_joined_factor %>%
  left_join(factored_questions, by = 'column_name_factor')
jamaica_joined_factor <- jamaica_joined_factor %>% 
  left_join(factored_categories, by = 'column_name_factor')
jamaica_joined_factor <- jamaica_joined_factor %>%
  filter(is.na(category) == FALSE)
```

## Combine the unfactored and factored versions together
In this section we combine the unfactored and factored versions together and join the countries using `bind_cols()`. The column, answer_measure, is converted back to a numeric.

We used the variable t just for convience. It stands for total.
```{r}
#Creating object t
t <- belize_category_factor %>%
  #Deselects category
  select(-category)
#Makes data frame that combines the unfactored dataset with the factored one stored in t
belize_total <- bind_cols(belize_category_unfactor,t)
#Transforms answer_measure to a numeric
belize_total  <- belize_total  %>%
  transform(answer_measure = as.numeric(answer_measure))

t <- argentina_joined_factor %>%
  select(-category)
argentina_total <- bind_cols(argentina_joined,t)
argentina_total  <- argentina_total  %>%
  transform(answer_measure = as.numeric(answer_measure))

t <- brazil_joined_factor %>%
  select(-category)
brazil_total <- bind_cols(brazil_joined,t)
brazil_total  <- brazil_total  %>%
  transform(answer_measure = as.numeric(answer_measure))


t <- chile_joined_factor %>%
  select(-category)
chile_total <- bind_cols(chile_joined,t)
chile_total  <- chile_total  %>%
  transform(answer_measure = as.numeric(answer_measure))

t <- panama_joined_factor %>%
  select(-category)
panama_total <- bind_cols(panama_joined,t)
panama_total  <- panama_total  %>%
  transform(answer_measure = as.numeric(answer_measure))

t <- paraguay_joined_factor %>%
  select(-category)
paraguay_total <- bind_cols(paraguay_joined,t)
paraguay_total  <- paraguay_total  %>%
  transform(answer_measure = as.numeric(answer_measure))

t <- peru_joined_factor %>%
  select(-category)
peru_total <- bind_cols(peru_joined,t)
peru_total  <- peru_total  %>%
  transform(answer_measure = as.numeric(answer_measure))

#t <- suriname_joined_factor %>% select(-category)
#suriname_total <- bind_cols(suriname_joined,t)
#suriname_total  <- suriname_total  %>% transform(answer_measure = as.numeric(answer_measure))

t <- uruguay_joined_factor %>%
  select(-category)
uruguay_total <- bind_cols(uruguay_joined,t)
uruguay_total  <- uruguay_total  %>%
  transform(answer_measure = as.numeric(answer_measure))

t <- venezuela_joined_factor %>%
  select(-category)
venezuela_total <- bind_cols(venezuela_joined,t)
venezuela_total  <- venezuela_total %>%
  transform(answer_measure = as.numeric(answer_measure))

t <- bolivia_joined_factor %>%
  select(-category)
bolivia_total <- bind_cols(bolivia_joined,t)
bolivia_total  <- bolivia_total %>%
  transform(answer_measure = as.numeric(answer_measure))

t <- canada_joined_factor %>%
  select(-category)
canada_total <- bind_cols(canada_joined,t)
canada_total  <- canada_total %>%
  transform(answer_measure = as.numeric(answer_measure))

t <- colombia_joined_factor %>%
  select(-category)
colombia_total <- bind_cols(colombia_joined,t)
colombia_total  <- colombia_total %>%
  transform(answer_measure = as.numeric(answer_measure))

t <- costa_joined_factor %>%
  select(-category)
costa_total <- bind_cols(costa_joined,t)
costa_total  <- costa_total %>%
  transform(answer_measure = as.numeric(answer_measure))

t <- ecuador_joined_factor %>%
  select(-category)
ecuador_total <- bind_cols(ecuador_joined,t)
ecuador_total <- ecuador_total %>%
  transform(answer_measure = as.numeric(answer_measure))

t <- elsalvador_joined_factor %>%
  select(-category)
elsalvador_total <- bind_cols(elsalvador_joined,t)
elsalvador_total <- elsalvador_total %>%
  transform(answer_measure = as.numeric(answer_measure))

t <- guatemala_joined_factor %>%
  select(-category)
guatemala_total <- bind_cols(guatemala_joined,t)
guatemala_total <- guatemala_total %>%
  transform(answer_measure = as.numeric(answer_measure))

t <- honduras_joined_factor %>%
  select(-category)
honduras_total <- bind_cols(honduras_joined,t)
honduras_total <- honduras_total %>%
  transform(answer_measure = as.numeric(answer_measure))

t <- mexico_joined_factor %>%
  select(-category)
mexico_total <- bind_cols(mexico_joined,t)
mexico_total <- mexico_total %>%
  transform(answer_measure = as.numeric(answer_measure))

t <- nicaragua_joined_factor %>%
  select(-category)
nicaragua_total <- bind_cols(nicaragua_joined, t)
nicaragua_total <- nicaragua_total %>%
  transform(answer_measure = as.numeric(answer_measure))

t <- usa_joined_factor %>%
  select(-category)
usa_total <- bind_cols(usa_joined,t)
usa_total <- usa_total %>%
  transform(answer_measure = as.numeric(answer_measure))

t <- guyana_joined_factor %>%
  select(-category)
guyana_total <- bind_cols(guyana_joined,t)
guyana_total <- guyana_total %>%
  transform(answer_measure = as.numeric(answer_measure))

t <- jamaica_joined_factor %>%
  select(-category)
jamaica_total <- bind_cols(jamaica_joined,t)
jamaica_total <- jamaica_total %>%
  transform(answer_measure = as.numeric(answer_measure))
```

# Creating a list of unwated variables
These variables are not to be shown in the visualizations, so in order to remove them from the datasets above, we created a vector with the variable names that will then be applied to a function that removes them.

If in the future you want to remove more variables, just add them to the list and run the same function.

```{r}
variables <- c('ls3r', 'a4r', 'cp4ar', 'np1r', 'np2r', 'prot3r', 'prot7r', 'jc15ar', 'vic1extr', 'vic1hogarr',
'jc10rr', 'jc13rr', 'sgl1r', 'm1r', 'cp5r', 'cp6r', 'cp7r', 'cp8r', 'cp9r', 'cp13r', 'cp20r', 'it1r', 'pn4r', 'pol1r', 'exc7r', 'community' ,'anyvictim', 'aoj11r', 'sd2r', 'sd3r', 'sd6r', 'coupr', 'b1r', 'b2r', 'b3r', 'b4r', 'b6r', 'b12r', 'b32r','n11r', 'n9r', 'mil3r', 'mil4r', 'eff1r', 'eff2r', 'mil7r', 'ing4r', 'ros1r', 'ros4r', 'psar', 'psa5r', 'psa2r', 'd1r', 'd2r', 'd3r', 'd4r', 'd5r', 'tolr', 'tol2r','bar2x2', 'exc2r', 'exc6r', 'ecexc11r', 'exc11r', 'exc13r', 'exc14r', 'exc15r', 'exc16r', 'exc20r', 'exctot', 'exctot5r', 'exctot3r', 'corvic', 'vb2r', 'mujer', 'edr', 'edad', 'age1', 'age2', 'age3', 'age4', 'age5', 'age6', 'q5br', 'q10dr', 'housewife', 'etidr', 'indigenous', 'black', 'white', 'mestizo', 'mulatto', 'other', 'quintall', 'ed2r', 'intid', 'ideology', 'ti', 'q11nr', 'q5bnr')
```

# Final clean
This function uses the list made above to remove the desire variables. It also further formats the data frame into the shape it needs to be when we bind all the countries together.

```{r}
clean <- function(country){
  #Filters out the column names that are not in the list, variables.
  country <- country %>%
   filter(!(column_name %in% variables)) %>%
    #Selects the columns that are no longer needed
    select(-wave_factor, -uniq_id, -column_name, -column_name_factor, -question_factor) %>% 
    #Renames pais_factor to country
    rename(country = pais_factor)
  return(country)
}
```

## Applying `clean()` to all countries
```{r}
belize_clean <- clean(belize_total)

argentina_clean <- clean(argentina_total)

brazil_clean <- clean(brazil_total)

chile_clean <- clean(chile_total)

panama_clean <- clean(panama_total)

paraguay_clean <- clean(paraguay_total)

peru_clean <- clean(peru_total)

#suriname_clean <- clean(suriname_total)

uruguay_clean <- clean(uruguay_total)

venezuela_clean <- clean(venezuela_total)

bolivia_clean <- clean(bolivia_total)

canada_clean <- clean(canada_total)

colombia_clean <- clean(colombia_total)

costa_clean <- clean(costa_total)

ecuador_clean <- clean(ecuador_total)

elsalvador_clean <- clean(elsalvador_total)

guatemala_clean <- clean(guatemala_total)

honduras_clean <- clean(honduras_total)

mexico_clean <- clean(mexico_total)

nicaragua_clean <- clean(nicaragua_total)

usa_clean <- clean(usa_total)

guyana_clean <- clean(guyana_total)

jamaica_clean <- clean(jamaica_total)
```


# Combining and choosing
In order to write a .csv file of the data, we combined all the countries using `bind_rows()` and saved it in a data frame called complete. However, because Tableau Public can only handle 15 million rows, we subset the data by filtering out for when wave is 2006, 2008, 2010, and 2012 and used this data frame to write the .csv.

We also removed the countries and their specific years that are not public. If you want to show some of them just remove or comment out the line. If you want to remove more countries and years, just use the same format shown below.

```{r}
#Combines all the datasets into single data frame
complete <- bind_rows(belize_clean, argentina_clean, brazil_clean, chile_clean, panama_clean, paraguay_clean, peru_clean, uruguay_clean, venezuela_clean, bolivia_clean, canada_clean, colombia_clean, costa_clean, ecuador_clean, elsalvador_clean, guatemala_clean, honduras_clean, mexico_clean, nicaragua_clean, usa_clean)

complete <- complete %>% 
  filter(!(pais == 41 & wave > 2008)) %>%
  filter(!(pais == 40 & wave > 2008)) %>%
  filter(!(pais == 16 & wave > 2008)) %>%
  filter(!(pais == 13 & wave > 2008)) %>%
  filter(!(pais == 17 & wave > 2008)) %>%
  filter(!(pais == 10 & wave > 2008)) %>%
  filter(!(pais == 27 & wave > 2008 & wave < 2014)) %>%
  filter(!(pais == 35 & wave > 2008 & wave < 2014)) %>%
  filter(!(pais == 9 & wave < 2014))
```





