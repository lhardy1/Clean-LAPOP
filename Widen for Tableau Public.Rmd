---
title: "Widen for Tableau Public"
output: html_notebook
editor_options: 
  chunk_output_type: inline
---

# Testing `janitor`
```{r}
library(janitor)
library(rlang)
```

## `clean_names()`
```{r}
test_df <- as.data.frame(matrix(ncol = 6))
names(test_df) <- c("firstName", "Ã¡bc@!", "% successful (2009)", "REPEAT VALUE", "REPEAT VALUE")
```

```{r}
test_df %>% 
  clean_names()
```

## Testing with LAPOP values
```{r}
argentina_16_factor %>% 
  clean_names()

bolivia_16_factor %>% 
  clean_names()
```

## `compare_df_cols()`

```{r}
df1 <- data.frame(a = 1:2, b = c("big", "small")) # a factor by default
df2 <- data.frame(a = 10:12, b = c("medium", "small", "big"), c = 0, stringsAsFactors = FALSE)
df3 <- df1 %>%
  dplyr::mutate(b = as.character(b))

compare_df_cols(df1, df2, df3)

compare_df_cols(df1, df2, df3, return = "mismatch")
compare_df_cols(df1, df2, df3, return = "mismatch", bind_method = "rbind") # default is dplyr::bind_rows
```

## Applying with Argentina and Bolivia

```{r}
compare_df_cols(argentina_16_factor, bolivia_16_factor)
```

```{r}
test1 <- argentina_16_factor %>% 
  select(-q2_factor)
test <- semi_join(test1, bolivia_16_factor, by = NULL)
```

```{r}
compare_df_cols(argentina_clean, bolivia_clean)
```

## Alternate approach
In the long format, try unique() on country name

We need country, wave, and questions to create a new data frame with `unique()`. Then we need to create a function that gets - `group_by()` - these columns, makes them unique, creates a new column with its count - `summarize(n())` - and finally filters down to the ones that occur in all datasets - `filter(x >= total # of countries)`.

*Current total number of countries is 23*

I am first going to test on Argentina and Bolivia.
### Collecting all questions
```{r}
argentina_narrow <- argentina_clean %>% 
  #Narrows data frame to two variables
  select(country, question) %>% 
  mutate(country = as.character(country)) %>% 
  #Returns each question once
  unique()

#Repeating the process
bolivia_narrow <- bolivia_clean %>% 
  #Narrows data frame to two variables
  select(country, question) %>% 
  mutate(country = as.character(country))
  #Returns each question once
  unique()

#test1 <- bind_rows(argentina_narrow, bolivia_narrow)
str(argentina_narrow)

select_questions <- function(country_df){
  country_df %>% 
    select(country, question) %>% 
    mutate(country = as.character(country)) %>% 
    unique()
}

#test1 <- select_questions(belize_clean)

countries <- list(argentina_clean, belize_clean, bolivia_clean, brazil_clean, canada_clean, chile_clean, colombia_clean, costa_clean, ecuador_clean, elsalvador_clean, guatemala_clean, guyana_clean, honduras_clean, jamaica_clean, mexico_clean, nicaragua_clean, panama_clean, paraguay_clean, peru_clean, suriname_clean, uruguay_clean, usa_clean, venezuela_clean)

#length(countries) There are 23 countries

combined_questions <- map_dfr(countries, select_questions)

number_of_repeats <- combined_questions %>% 
  n_distinct()

number_of_repeats
```

### Filter common questions
```{r}
find_common_questions <- function(country1, country2){
  left_join(country1, country2, by = "question") %>% 
    filter(!is.na(country.x)) %>% 
    filter(!is.na(country.y))
}

first_test <- find_common_questions(argentina_narrow, bolivia_narrow)

first_test
```

