---
title: "1- read in"
output: html_notebook
---
This is two parts: there is one part that works only with one specific dataframe, and divides up the unfactored and factored sections in that dataframe- PART A. There is another part that works with two dataframes: the factored and unfactored version - PART B
Load all libraries
```{r}
library(labelled)
library(sjmisc)
library(tidyr)
library(tidyverse)
library(dplyr)
library(haven)
```


#PART A
The first step is to read in the data, split it up into what needs to be factored vs what doesn't, and then return the new data set of the combined unfactored and factored version
```{r}
#function used to factor the data frame
factor_country <- function(country) {
  country_factor <- as_factor(country)
  return(country_factor)
}

#makes list that will then store column names to factor
factor <- rep(NA, 900)
i <- 1
x <- 1
factor_unfactor_combine <- function(filename){
  #reads in the data
  country <- read_dta(filename)
  #makes a list of all the columns that are present in the country
  columns <- attributes(country)$names
  #creates a dataframe that the unfactored data can be held in
  unfactor <- data_frame('extra' = country$pais)
  #loops throuh each of the columns determining if it needs to be factored or not
  pais <- as_factor(country %>% select(pais))
  country <- country %>% select(-pais)
  country <- cbind(country, pais)
  while(x <= length(columns)){
    #stores one of the columns in d, have to use !!! syms because columns is in a string list format
    d <- (country %>% select(!!! syms(columns[x])))
    #if 6,7,8,9, or 10 are in d
    if((6 %in% d[[unlist(columns[x])]] || 7 %in% d[[unlist(columns[x])]] || 8 %in% d[[unlist(columns[x])]] || 9 %in% d[[unlist(columns[x])]] || 10 %in% d[[unlist(columns[x])]])){
      #if it is then add to the dataframe created earlier
      unfactor <- cbind(unfactor, d)
    }
    else{
      #if it isn't then add the column name to a list factor
      factor[i] <- unlist(columns[x])
      i <- i + 1
    }
    x <-  x + 1
  }
  #remove "extra" the column originally used to create the dataframe
  unfactor <- unfactor %>% select(-extra)
  #select the columns that should be factored, shrink country down to just those columns and factor it
  factor <- factor[!is.na(factor)]
  country <- country[factor]
  factored_country <- factor_country(country)
  #combine unfactored and factored together
  full_country <- cbind(factored_country, unfactor)
  
  return(full_country)
}
```



```{r}

panama <- factor_unfactor_combine("1909860951Panama LAPOP merge 2004-2014 v3.0_W_dta.zip")
argentina <- factor_unfactor_combine("1326054827Argentina LAPOP merge 2008-2014 v3.0_W_dta.zip")
bolivia <- factor_unfactor_combine("1500779614Bolivia LAPOP merge 2004-2014 v3.0_W_dta.zip")
brazil <- factor_unfactor_combine("1058457654Brazil LAPOP merge 2007-2014 v3.0_W_dta.zip")
belize <- factor_unfactor_combine("1866361808Belize LAPOP merge 2008-2014 v3.0_W_dta.zip")
canada <- factor_unfactor_combine("257165704Canada LAPOP merge 2006-2014 v3.0_W_dta.zip")
chile <- factor_unfactor_combine("1651690880Chile LAPOP merge 2006-2014 v3.0_W_dta.zip")
colombia <- factor_unfactor_combine("26761406Colombia LAPOP merge 2004-2014 v3.0_W_dta.zip")
costa <- factor_unfactor_combine("312640706CostaRica LAPOP merge 2004-2014 v3.0_W_dta.zip")
ecuador <- factor_unfactor_combine("1562314955Ecuador LAPOP merge 2004-2014 v3.0_W_dta.zip")
elsalvador <- factor_unfactor_combine("71618678ElSalvador LAPOP merge 2004-2014 v3.0_W_dta.zip")
guatemala <- factor_unfactor_combine("833541857Guatemala LAPOP merge 2004-2014 v3.0_W_dta.zip")
guyana <- factor_unfactor_combine("1293237393Guyana LAPOP merge 2006-2014 v3.0_W_dta.zip")
paraguay <- factor_unfactor_combine("450650714Paraguay LAPOP merge 2006-2014 v3.0_W_dta.zip")
honduras <- factor_unfactor_combine("125162980Honduras LAPOP merge 2004-2014 v3.0_W_dta.zip")
jamaica <- factor_unfactor_combine("1518553693Jamaica LAPOP merge 2006-2014 v3.0_W_dta.zip")
mexico <- factor_unfactor_combine("1467358429Mexico LAPOP merge 2004-2014 v3.0_W_dta.zip")
nicaragua <- factor_unfactor_combine("420919900Nicaragua LAPOP merge 2004-2014 v3.0_W_dta.zip")
peru <- factor_unfactor_combine("897206140Peru LAPOP merge 2006-2014 v3.0_W_dta.zip")
suriname <- factor_unfactor_combine("2028239474Suriname LAPOP merge 2010-2014 v3.0_W_dta.zip")
usa <- factor_unfactor_combine("1355754260UnitedStates LAPOP merge 2006-2014 v3.0_W_dta.zip")
uruguay <- factor_unfactor_combine("1222977998Uruguay LAPOP merge 2007-2014 v3.0_W_dta.zip")
venezuela <- factor_unfactor_combine("1165310382Venezuela LAPOP merge 2007-2014 v3.0_W_dta.zip")
```

#PART B
for creating factored and unfactored columns together so that they can be exchanged
```{r}
factor_country <- function(country){
  #reads file for the country
  country <- read_dta(country)
  #factors all the columns
  country <- as_factor(country)
  
  #starts list x
  x <- 1
  
  #changes name of column to add "factor"
  while(x <= length(country)){
    colnames(country)[x] <- paste(colnames(country)[x], "factor", sep = "-")
    x <- x + 1
  }
  country
}
```

factored dataframes
```{r}
panama_factor <- factor_country("1909860951Panama LAPOP merge 2004-2014 v3.0_W_dta.zip")
argentina_factor <- factor_country("1326054827Argentina LAPOP merge 2008-2014 v3.0_W_dta.zip")
bolivia_factor <- factor_country("1500779614Bolivia LAPOP merge 2004-2014 v3.0_W_dta.zip")
brazil_factor <- factor_country("1058457654Brazil LAPOP merge 2007-2014 v3.0_W_dta.zip")
belize_factor <- factor_country("1866361808Belize LAPOP merge 2008-2014 v3.0_W_dta.zip")
canada_factor <- factor_country("257165704Canada LAPOP merge 2006-2014 v3.0_W_dta.zip")
chile_factor <- factor_country("1651690880Chile LAPOP merge 2006-2014 v3.0_W_dta.zip")
colombia_factor <- factor_country("26761406Colombia LAPOP merge 2004-2014 v3.0_W_dta.zip")
costa_factor <- factor_country("312640706CostaRica LAPOP merge 2004-2014 v3.0_W_dta.zip")
ecuador_factor <- factor_country("1562314955Ecuador LAPOP merge 2004-2014 v3.0_W_dta.zip")
elsalvador_factor <- factor_country("71618678ElSalvador LAPOP merge 2004-2014 v3.0_W_dta.zip")
guatemala_factor <- factor_country("833541857Guatemala LAPOP merge 2004-2014 v3.0_W_dta.zip")
guyana_factor <- factor_country("1293237393Guyana LAPOP merge 2006-2014 v3.0_W_dta.zip")
paraguay_factor <- factor_country("450650714Paraguay LAPOP merge 2006-2014 v3.0_W_dta.zip")
honduras_factor <- factor_country("125162980Honduras LAPOP merge 2004-2014 v3.0_W_dta.zip")
jamaica_factor <- factor_country("1518553693Jamaica LAPOP merge 2006-2014 v3.0_W_dta.zip")
mexico_factor <- factor_country("1467358429Mexico LAPOP merge 2004-2014 v3.0_W_dta.zip")
nicaragua_factor <- factor_country("420919900Nicaragua LAPOP merge 2004-2014 v3.0_W_dta.zip")
peru_factor <- factor_country("897206140Peru LAPOP merge 2006-2014 v3.0_W_dta.zip")
suriname_factor <- factor_country("2028239474Suriname LAPOP merge 2010-2014 v3.0_W_dta.zip")
usa_factor <- factor_country("1355754260UnitedStates LAPOP merge 2006-2014 v3.0_W_dta.zip")
uruguay_factor <- factor_country("1222977998Uruguay LAPOP merge 2007-2014 v3.0_W_dta.zip")
venezuela_factor <- factor_country("1165310382Venezuela LAPOP merge 2007-2014 v3.0_W_dta.zip")
```

unfactored dataframes
```{r}
panama_unfactor <- read_dta("1909860951Panama LAPOP merge 2004-2014 v3.0_W_dta.zip")
argentina_unfactor <- read_dta("1326054827Argentina LAPOP merge 2008-2014 v3.0_W_dta.zip")
bolivia_unfactor <- read_dta("1500779614Bolivia LAPOP merge 2004-2014 v3.0_W_dta.zip")
brazil_unfactor <- read_dta("1058457654Brazil LAPOP merge 2007-2014 v3.0_W_dta.zip")
belize_unfactor <- read_dta("1866361808Belize LAPOP merge 2008-2014 v3.0_W_dta.zip")
canada_unfactor <- read_dta("257165704Canada LAPOP merge 2006-2014 v3.0_W_dta.zip")
chile_unfactor <- read_dta("1651690880Chile LAPOP merge 2006-2014 v3.0_W_dta.zip")
colombia_unfactor <- read_dta("26761406Colombia LAPOP merge 2004-2014 v3.0_W_dta.zip")
costa_unfactor <- read_dta("312640706CostaRica LAPOP merge 2004-2014 v3.0_W_dta.zip")
ecuador_unfactor <- read_dta("1562314955Ecuador LAPOP merge 2004-2014 v3.0_W_dta.zip")
elsalvador_unfactor <- read_dta("71618678ElSalvador LAPOP merge 2004-2014 v3.0_W_dta.zip")
guatemala_unfactor <- read_dta("833541857Guatemala LAPOP merge 2004-2014 v3.0_W_dta.zip")
guyana_unfactor <- read_dta("1293237393Guyana LAPOP merge 2006-2014 v3.0_W_dta.zip")
paraguay_unfactor <- read_dta("450650714Paraguay LAPOP merge 2006-2014 v3.0_W_dta.zip")
honduras_unfactor <- read_dta("125162980Honduras LAPOP merge 2004-2014 v3.0_W_dta.zip")
jamaica_unfactor <- read_dta("1518553693Jamaica LAPOP merge 2006-2014 v3.0_W_dta.zip")
mexico_unfactor <- read_dta("1467358429Mexico LAPOP merge 2004-2014 v3.0_W_dta.zip")
nicaragua_unfactor <- read_dta("420919900Nicaragua LAPOP merge 2004-2014 v3.0_W_dta.zip")
peru_unfactor <- read_dta("897206140Peru LAPOP merge 2006-2014 v3.0_W_dta.zip")
suriname_unfactor <- read_dta("2028239474Suriname LAPOP merge 2010-2014 v3.0_W_dta.zip")
usa_unfactor <- read_dta("1355754260UnitedStates LAPOP merge 2006-2014 v3.0_W_dta.zip")
uruguay_unfactor <- read_dta("1222977998Uruguay LAPOP merge 2007-2014 v3.0_W_dta.zip")
venezuela_unfactor <- read_dta("1165310382Venezuela LAPOP merge 2007-2014 v3.0_W_dta.zip")
```



