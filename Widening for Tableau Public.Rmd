---
title: "Widening for Tableau Public"
output: html_notebook
editor_options: 
  chunk_output_type: inline
---

# Structure

Now that we finally have a single dataframe with all the countries with only the common questions, we need to widen it so that it fits within Tableau Public's limit.

In order to do this we are going to:

* combine columns into the format of "category:question text"
* select the necessary columns (country, wave, person_id, weight, category_question, answer_measure)

```{r}
library(rlang)
```

## Combining category and question
```{r}
countries_common_only <- countries_common_only %>% 
  unite(category_question, category, question, sep = ":")
```

## Pivoting Wider
```{r}
countries_common_only <- countries_common_only %>% 
  select(country, wave, person_id_factor, weights, category_question, answer_measure) %>% 
  pivot_wider(names_from = category_question, values_from = answer_measure)
```

Ran into error saying that values are not uniquely identified. Going to try to identify duplicates
```{r}
test0 <- countries_common_only %>% 
  select(country, wave, person_id_factor, weights, category_question, answer_measure) %>% 
  filter(country == c("Argentina", "Bolivia")) %>% 
  pivot_wider(names_from = category_question, values_from = answer_measure)
```

Error occurs again here going to look into other arguments in `pivot_wider()`
```{r}
test1 <- countries_common_only %>% 
  select(country, wave, person_id_factor, weights, category_question, answer_measure) %>% 
  filter(country == c("Argentina", "Bolivia")) %>% 
  pivot_wider(names_from = category_question, names_repair = "unique", values_from = answer_measure)
```



